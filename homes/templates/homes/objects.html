{% extends "homes/base.html" %}

{% load static from staticfiles %}

{% block extra_css %}{% endblock extra_css %}

{% block content %}

    <section>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <ol class="breadcrumb">
                        <li><a href="{% url "homes" %}">Главная</a></li>
                        <li class="active">Объекты</li>
                    </ol>
                </div>
            </div>
        </div>
    </section>
    <section class="content">
        <div class="container">
            <div class="row section-search">
                <div class="col-md-12">
                    <h1 class="section-head">Поиск <span>объектов</span></h1>
                    <div class="section-sort">
                        <a href="#" class="extend-block">
                            <i class="fa fa-filter"></i> Расширеный поиск
                        </a>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="col-md-12 substrate">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="typeobj">Тип объекта</label>
                                    <select id="type_facility" class="multiple" multiple="multiple" placeholder="-----">
                                        {% for facility in type_facility %}
                                            <option value="{{ facility.id }}">{{ facility.type_facility }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="price">Цена</label>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <input id="price_on" type="text" placeholder="От">
                                                </div>
                                                <div class="col-md-6">
                                                    <input id="price_for" type="text" placeholder="До">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <select name="" id="currency" style="min-width: 100%">
                                                {% for carrency in list_carrency %}
                                                    <option value="{{ carrency.currency.id }}">{{ carrency.currency }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="actual">Актуальность</label>
                                    <select id="actuality">
                                        <option selected="selected">-----</option>
                                        {% for actuality in type_actuality %}
                                            <option value="{{ actuality.type_actuality.id }}">{{ actuality.type_actuality }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="tarea">Район</label>
                                    <select class="tarea-multiple" multiple="multiple" placeholder="-----" id="district">
                                        {% for district in list_district %}
                                            <option value="{{ district.district.id }}">{{ district.district }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="price">Площадь</label>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <input type="text" placeholder="От">
                                        </div>
                                        <div class="col-md-6">
                                            <input type="text" placeholder="До">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="stat">Состояние</label>
                                    <select>
                                        <option selected="selected">-----</option>
                                        <option>Ищем</option>
                                        <option>Незвонить</option>
                                        <option>Занят арендатором</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="idobj">ID Объекта</label>
                                    <input type="text" placeholder="-----">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="phone">Телефон</label>
                                    <input type="text" placeholder="-----">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="search-item">
                                    <label for="phone">Пересмотр <i class="fa fa-calendar"></i></label>
                                    <input id="peresmotr" type="text" placeholder="-----">
                                </div>
                            </div>
                        </div>
                        <div class="extended-search" style="height: 0px">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="typeobj">Этажность</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <input type="text" placeholder="От">
                                            </div>
                                            <div class="col-md-6">
                                                <input type="text" placeholder="До">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="typeobj">Комнаты</label>
                                        <select class="multiple" multiple="multiple" placeholder="-----">
                                            <option>Смежные</option>
                                            <option>Раздельные</option>
                                            <option>Смежно-раздельные</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="street">Улица</label>
                                        <select>
                                            <option selected="selected">-----</option>
                                            <option>ул.Полуботка</option>
                                            <option>ул. Шевченка</option>
                                            <option>ул. Щорса</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="">Этаж</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <input type="text" placeholder="От">
                                            </div>
                                            <div class="col-md-6">
                                                <input type="text" placeholder="До">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="">Комнат</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <input type="text" placeholder="От">
                                            </div>
                                            <div class="col-md-6">
                                                <input type="text" placeholder="До">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="stat">Номер дома</label>
                                        <input type="text" placeholder="-----">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="">Контактное лицо</label>
                                        <input type="text" placeholder="-----">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="phone">Кухня</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <input type="text" placeholder="От">
                                            </div>
                                            <div class="col-md-6">
                                                <input type="text" placeholder="До">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="">Тип строения</label>
                                        <select>
                                            <option selected="selected">-----</option>
                                            <option>Малосемейка</option>
                                            <option>Панельный</option>
                                            <option>Новострой</option>
                                            <option>Малосемейка</option>
                                            <option>VIP</option>
                                            <option>Грущевка</option>
                                            <option>Чешка</option>
                                            <option>Гостинка</option>
                                            <option>Сталинка</option>
                                            <option>Сотовая</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="search-item">
                                        <label for="">Комментарий</label>
                                        <input type="text" placeholder="-----">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="search-item">
                                                <label for="price">VIP <i class="fa fa-star"></i></label>
                                                <input type="checkbox">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="search-item">
                                                <label for="price">На сайте <i class="fa fa-globe"></i></label>
                                                <input type="checkbox">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 btn-search">
                                <a href="{% url request.path|cut:'/' %}" class="btn btn-red">Очистить</a>
                                <a id="search_obj" href="#" class="btn btn-blue">Применить</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row search-object">
                <div class="col-md-12">
                    <h1 class="section-head">Ваши <span>объекты </span> <i class="label label-default">{{ all_contact_owner|length }}</i></h1>
                    <div class="section-sort">
                        <a href="{% url "add_object" %}" class="btn btn-green">Добавить</a>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="tabs">
                        <ul class="main-tabs">
                            <li {% if '/objects' in request.path %} class="tabs-active" {% endif %}><a href="{% url 'objects' %}">Все <span class="label label-default">{{ all_contact_owner|length }}</span></a></li>
                            <li {% if '/selling' in request.path %} class="tabs-active" {% endif %}><a href="{% url 'selling' %}">Продам <span class="label label-default">{{ all_contact_owner_se|length }}</span></a></li>
                            <li {% if '/arend' in request.path %} class="tabs-active" {% endif %}><a href="{% url 'arend' %}">Сдам <span class="label label-default">{{ all_contact_owner_ad|length }}</span></a></li>
                        </ul>
                        <ul class="object-filter">
                            {% with order_by=request.GET.order_by reverse=request.GET.reverse %}
                                <li><a href="{% url request.path|cut:'/' %}?order_by=id{% if order_by == 'id' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                    {% if order_by == 'id' and reverse == '1' %}&darr;
                                    {% elif order_by == 'id' %}
                                            &uarr;
                                    {% endif %}
                                    Артикул
                                </a></li>
                                <li><a href="{% url request.path|cut:'/' %}?order_by=price_bay{% if order_by == 'price_bay' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                    {% if order_by == 'price_bay' and reverse == '1' %}&darr;
                                    {% elif order_by == 'price_bay' %}
                                            &uarr;
                                    {% endif %}
                                    Цена продажи
                                </a></li>
                                <li><a href="{% url request.path|cut:'/' %}?order_by=price_month{% if order_by == 'price_month' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                    {% if order_by == 'price_month' and reverse == '1' %}&darr;
                                    {% elif order_by == 'price_month' %}
                                            &uarr;
                                    {% endif %}
                                    Цена аренди
                                </a></li>
                                <li><a href="{% url request.path|cut:'/' %}?order_by=total_area{% if order_by == 'total_area' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                    {% if order_by == 'total_area' and reverse == '1' %}&darr;
                                    {% elif order_by == 'total_area' %}
                                            &uarr;
                                    {% endif %}
                                    Метраж
                                </a></li>
                                <li><a href="{% url request.path|cut:'/' %}?order_by=date_of_renovation{% if order_by == 'date_of_renovation' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                    {% if order_by == 'date_of_renovation' and reverse == '1' %}&darr;
                                    {% elif order_by == 'date_of_renovation' %}
                                            &uarr;
                                    {% endif %}
                                    Дата обновления
                                </a></li>
                                <li><a href="{% url request.path|cut:'/' %}?order_by=review_date{% if order_by == 'review_date' and reverse != '1' %}&amp;reverse=1{% endif %}">
                                    {% if order_by == 'review_date' and reverse == '1' %}&darr;
                                    {% elif order_by == 'review_date' %}
                                            &uarr;
                                    {% endif %}
                                    Дата пересмотра
                                </a></li>
                            {% endwith %}
                        </ul>
                    </div>
                </div>
                {% for object_data in contact_owner %}
                    {% if object_data.loyality.get.id == '' %}
                        {% include 'homes/obj_facility.html' %}
                    {% elif object_data.loyality.get.id == user.id or user.is_superuser %}
                        {% include 'homes/obj_facility.html' %}
                    {% endif %}
                {% endfor %}
                {% if contact_owner.has_other_pages %}
                    {% with order_by=request.GET.order_by reverse=request.GET.reverse %}
                        <div class="col-md-12 section-pagination">
                            <ul class="pagination">
                                <li><a href="{% url request.path|cut:'/' %}?page=1&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">&laquo;</a></li>
                                {% for p in contact_owner.paginator.page_range %}
                                    <li {% if contact_owner.number == p %}class="active"{% endif %}>
                                        <a href="{% url request.path|cut:'/' %}?page={{ p }}&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">{{ p }}</a>
                                    </li>
                                {% endfor %}
                                <li><a href="{% url request.path|cut:'/' %}?page={{ contact_owner.paginator.num_pages}}&amp;order_by={{ order_by }}&amp;reverse={{ reverse }}">&raquo;</a></li>
                            </ul>
                        </div>
                    {% endwith %}
                {% endif %}
            </div>
        </div>
    </section>
{% endblock content %}
{% block extra_js %}
    <script>
    $(function() {
        $("#typeobj").selectmenu();
        $(".tarea-multiple").select2();
        $("#idobj").selectmenu();
        $("#actual").selectmenu();
        $("#stat").selectmenu();
        $("#stat").selectmenu();
        $("#street").selectmenu();
        $("#typebuild").selectmenu();
        $("#peresmotr").datepicker();
        $(".multiple").select2();
        $(".extend-block").click(function() {
            var x = $(".extended-search").css('height');
            console.log(x);
            if (x == '0px') {
                $(".extended-search").css('height', '');
            } else {
                $(".extended-search").css('height', '0px');
            }

        });

    });
    </script>
    <script>
        $(document).ready(function() {
            $('.popup-gallery').magnificPopup({
                delegate: 'a',
                type: 'image',
                tLoading: 'Loading image #%curr%...',
                mainClass: 'mfp-img-mobile',
                gallery: {
                    enabled: true,
                    navigateByImgClick: true,
                    preload: [0,1] // Will preload 0 - before current, and 1 after the current image
                },
                image: {
                    tError: '<a href="%url%">The image #%curr%</a> could not be loaded.'
                }
            });
            $('#search_obj').on('click', function (event) {
                event.preventDefault();
                var type_facility = $('#type_facility').val();
                var price_on = $('#price_on').val();
                var price_for = $('#price_for').val();
                var currency = $('#currency').val();
                var actuality = $('#actuality').val();
                var district = $('#district').val();
                var list_data = {
                    "type_facility": type_facility,
                    "price_on": price_on,
                    "price_for": price_for,
                    "carrency": currency,
                    "actuality": actuality,
                    "district": district
                };
                $.get('search_obj', list_data)
            })
        });
    </script>
{% endblock extra_js %}


